"""Generated object model: vulnerability.

Auto-generated from OCSF schema version 1.8.0-dev.
DO NOT EDIT MANUALLY.
"""

from ..base import OcsfBase, OcsfTimestampMixin
from .object import OcsfObject
from .advisory import OcsfAdvisory
from .affected_code import OcsfAffectedCode
from .affected_package import OcsfAffectedPackage
from .cve import OcsfCve
from .cwe import OcsfCwe
from .kb_article import OcsfKbArticle
from .package import OcsfPackage
from .remediation import OcsfRemediation
from typing import Optional, List
from sqlalchemy import BigInteger, Boolean, ForeignKey, Integer, Text
from sqlalchemy.orm import Mapped, mapped_column, relationship


class OcsfVulnerability(OcsfObject):
    """Vulnerability Details.

    The vulnerability is an unintended characteristic of a computing
    component or system configuration that multiplies the risk of an adverse
    event or a loss occurring either due to accidental exposure, deliberate
    attack, or conflict with new system components.

    Inheritance chain: vulnerability -> object
    """
    __tablename__ = "ocsf_vulnerability"

    # Joined table inheritance from object
    id: Mapped[int] = mapped_column(
        ForeignKey("ocsf_object.id", ondelete="CASCADE"),
        primary_key=True,
    )
    __mapper_args__ = {"polymorphic_identity": "vulnerability"}

    # Attributes
    advisory_id: Mapped[Optional[int]] = mapped_column(
        ForeignKey("ocsf_advisory.id", ondelete="SET NULL"),
        comment="Detail about the security advisory, that is used to publicly disclose cybersecurity vulnerabilities by a vendor.",
        nullable=True,
    )
    category: Mapped[Optional[str]] = mapped_column(
        Text,
        comment="The category of a vulnerability or weakness, as reported by the source tool, such as <code>Container Security</code> or <code>Open Source Security</code>.",
        nullable=True,
    )
    cve_id: Mapped[Optional[int]] = mapped_column(
        ForeignKey("ocsf_cve.id", ondelete="SET NULL"),
        comment="Describes the Common Vulnerabilities and Exposures <a target='_blank' href='https://cve.mitre.org/'>(CVE)</a> details related to the vulnerability.",
        nullable=True,
    )
    cwe_id: Mapped[Optional[int]] = mapped_column(
        ForeignKey("ocsf_cwe.id", ondelete="SET NULL"),
        comment="Describes the Common Weakness Enumeration <a target='_blank' href='https://cwe.mitre.org/'>(CWE)</a> details related to the vulnerability.",
        nullable=True,
    )
    dependency_chain: Mapped[Optional[str]] = mapped_column(
        Text,
        comment="Information about the chain of dependencies related to the issue as reported by an Application Security or Vulnerability Management tool. E.g., <code>serverless-offline -> @serverless/utils ->...",
        nullable=True,
    )
    desc: Mapped[Optional[str]] = mapped_column(
        Text,
        comment="The description of the vulnerability.",
        nullable=True,
    )
    exploit_last_seen_time: Mapped[Optional[int]] = mapped_column(
        BigInteger,
        comment="The time when the exploit was most recently observed.",
        nullable=True,
    )
    exploit_ref_url: Mapped[Optional[str]] = mapped_column(
        Text,
        comment="The URL of the exploit code or Proof-of-Concept (PoC).",
        nullable=True,
    )
    exploit_requirement: Mapped[Optional[str]] = mapped_column(
        Text,
        comment="The requirement description related to any constraints around exploit execution.",
        nullable=True,
    )
    exploit_type: Mapped[Optional[str]] = mapped_column(
        Text,
        comment="The categorization or type of Exploit. E.g., <code>Network</code> or <code>Physical</code>.",
        nullable=True,
    )
    first_seen_time: Mapped[Optional[int]] = mapped_column(
        BigInteger,
        comment="The time when the vulnerability was first observed.",
        nullable=True,
    )
    fix_available: Mapped[Optional[bool]] = mapped_column(
        Boolean,
        comment="Indicates if a fix is available for the reported vulnerability.",
        nullable=True,
    )
    fix_coverage: Mapped[Optional[str]] = mapped_column(
        Text,
        comment="The fix coverage, normalized to the caption of the <code>fix_coverage_id</code> value.",
        nullable=True,
    )
    fix_coverage_id: Mapped[Optional[int]] = mapped_column(
        Integer,
        comment="The normalized identifier for fix coverage, applicable to this vulnerability. Typically useful, when there are multiple affected packages but only a subset have available fixes.",
        nullable=True,
    )
    is_exploit_available: Mapped[Optional[bool]] = mapped_column(
        Boolean,
        comment="Indicates if an exploit or a PoC (proof-of-concept) is available for the reported vulnerability.",
        nullable=True,
    )
    is_fix_available: Mapped[Optional[bool]] = mapped_column(
        Boolean,
        comment="Indicates if a fix is available for the reported vulnerability.",
        nullable=True,
    )
    last_seen_time: Mapped[Optional[int]] = mapped_column(
        BigInteger,
        comment="The time when the vulnerability was most recently observed.",
        nullable=True,
    )
    remediation_id: Mapped[Optional[int]] = mapped_column(
        ForeignKey("ocsf_remediation.id", ondelete="SET NULL"),
        comment="The remediation recommendations on how to mitigate the identified vulnerability.",
        nullable=True,
    )
    severity: Mapped[Optional[str]] = mapped_column(
        Text,
        comment="The vendor assigned severity of the vulnerability.",
        nullable=True,
    )
    title: Mapped[Optional[str]] = mapped_column(
        Text,
        comment="A title or a brief phrase summarizing the discovered vulnerability.",
        nullable=True,
    )
    vendor_name: Mapped[Optional[str]] = mapped_column(
        Text,
        comment="The name of the vendor that identified the vulnerability.",
        nullable=True,
    )

    # Relationships
    advisory: Mapped[Optional["OcsfAdvisory"]] = relationship(
        "OcsfAdvisory",
        foreign_keys=[advisory_id],
        back_populates="vulnerabilities",
    )
    affected_code: Mapped[List["OcsfAffectedCode"]] = relationship(
        "OcsfAffectedCode",
        secondary="ocsf_vulnerability_affected_code",
        back_populates="vulnerabilities",
    )
    affected_packages: Mapped[List["OcsfAffectedPackage"]] = relationship(
        "OcsfAffectedPackage",
        secondary="ocsf_vulnerability_affected_packages",
        back_populates="vulnerabilities",
    )
    cve: Mapped[Optional["OcsfCve"]] = relationship(
        "OcsfCve",
        foreign_keys=[cve_id],
        back_populates="vulnerabilities",
    )
    cwe: Mapped[Optional["OcsfCwe"]] = relationship(
        "OcsfCwe",
        foreign_keys=[cwe_id],
        back_populates="vulnerabilities",
    )
    kb_article_list: Mapped[List["OcsfKbArticle"]] = relationship(
        "OcsfKbArticle",
        secondary="ocsf_vulnerability_kb_article_list",
        back_populates="vulnerabilities",
    )
    packages: Mapped[List["OcsfPackage"]] = relationship(
        "OcsfPackage",
        secondary="ocsf_vulnerability_packages",
        back_populates="vulnerabilities",
    )
    remediation: Mapped[Optional["OcsfRemediation"]] = relationship(
        "OcsfRemediation",
        foreign_keys=[remediation_id],
        back_populates="vulnerabilities",
    )

    def __repr__(self) -> str:
        return f"<OcsfVulnerability(id={self.id})>"